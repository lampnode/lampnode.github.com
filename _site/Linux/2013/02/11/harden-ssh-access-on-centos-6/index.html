
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Harden SSH access on CentOS 6 | LAMPNODE | Focus On LAMP Technologies</title>
    <meta name="description" content="">
    <meta name="author" content="Robert  Chain">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <script  type="text/javascript" src="/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="/scripts/jquery.tools.js"></script>
    <link rel="shortcut icon" href="/images/favicon.ico">
    <!-- touch icons
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
	--> 
 </head>
  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/" name="top"> &lt;? LAMPNode</a>
          <ul class="nav">
            
            
            


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">关于本站</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">文档归类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">技术档案</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">技术日志</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">文档标签</a></li>
      	
      
    
  



          </ul>

	<ul class="nav pull-right">
            <li class="sharing">	
	 	<!-- Baidu Button BEGIN -->
		<div id="bdshare" class="bdshare_t bds_tools get-codes-bdshare">
    			<a class="bds_tsina"></a>
    			<a class="bds_renren"></a>
    			<a class="bds_tqq"></a>
    			<a class="bds_qzone"></a>
    			<a class="bds_kaixin001"></a>
    			<a class="bds_fbook"></a>
    			<a class="bds_twi"></a>
    			<a class="shareCount"></a>
		</div>
		<script type="text/javascript" id="bdshare_js" data="type=slide&amp;mini=1&amp;img=6&amp;uid=679970" ></script>
		<script type="text/javascript" id="bdshell_js"></script>
		<script type="text/javascript">
			var bds_config = {"bdTop":180};
			document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + new Date().getHours();
		</script>
		<!-- Baidu Button END --> 
		</li>
            <li class="divider-vertical"></li>
          </ul>
	</div>
      </div>
    </div>
	 
   <div class="container">
      <div class="content">
         <div class="contentNavi">
	   <div class="contentNaviBox">
		<p class="contentNaviBoxTitle">标签 | Tags</p>
           	<ul class="tag_box inline">
  			
  			


  
     
    	<li><a href="/tags.html#tutorial-ref">tutorial <span>1</span></a></li>
     
    	<li><a href="/tags.html#intro-ref">intro <span>1</span></a></li>
     
    	<li><a href="/tags.html#CentOs-ref">CentOs <span>4</span></a></li>
     
    	<li><a href="/tags.html#jekyll-ref">jekyll <span>1</span></a></li>
     
    	<li><a href="/tags.html#Ubuntu-ref">Ubuntu <span>2</span></a></li>
     
    	<li><a href="/tags.html#beginner-ref">beginner <span>1</span></a></li>
    
  



	   	</ul>
	  </div>
	   <div class="contentNaviBox">
		<p class="contentNaviBoxTitle">类别 | Categories</p>
      	      	<ul class="tag_box inline">
  			
                	


  
     
    	<li><a href="/categories.html#Github-ref">
    		Github <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#lessons-ref">
    		lessons <span>1</span>
    	</a></li>
     
    	<li><a href="/categories.html#Linux-ref">
    		Linux <span>5</span>
    	</a></li>
    
  


	      	</ul>
	   </div>
	  <div class="contentNaviBox">
	  	<p class="contentNaviBoxTitle">链接 | Links</p> 
	  	<ul>
			<li><a href="http://www.php.net">PHP.net</a></li>
			<li><a href="http://www.centos.org">Centos.org</a></li>
		</ul>   
	  </div>
	</div>
	<div class="contentMain"> 
	 
<div class="page-content-title">
  <h1>Harden SSH access on CentOS 6</h1>
   
</div>

<div class="page-content-info">
    <h4>Published</h4>
    <div class="date"><span>11 February 2013</span></div>

  
    <h4>Tags</h4>
    <ul class="tag_box">
    
    


  
     
    	<li><a href="/tags.html#CentOs-ref">CentOs <span>4</span></a></li>
    
  



    </ul>
  
</div>


<div class="row">
  <div class="span8">
    <p>In a few simple steps, you will be able to diminish risks of unauthorized ssh accesses Your ssh settings can be found in &#8220;/etc/ssh/sshd_config&#8221;, this is where you will have to modify the configuration settings below.</p>

<p>Note: The config file is NOT &#8220;/etc/ssh/ssh_config&#8221;</p>

<h2 id='change_your_ssh_port'>Change your ssh port</h2>

<h3 id='modify_config'>Modify config</h3>

<p>By default, ssh run on port 22. You will need to change this default value to an arbitrary port number :</p>

<pre><code>[root@server.com]#vim /etc/ssh/sshd_config</code></pre>

<p>This will require ssh connexions to use the 60125 port</p>

<pre><code>Port 60128</code></pre>

<h2 id='setup_iptables'>Setup iptables</h2>

<pre><code>[root@server.com]# vim /etc/sysconfig/iptables</code></pre>

<p>Add the following to this file:</p>

<pre><code>-A INPUT -m state --state NEW -m tcp -p tcp --dport 60128 -j ACCEPT</code></pre>

<p>Restart and check the the iptables:</p>

<pre><code>[root@server.com]# /etc/init.d/iptables restart
[root@server.com]# iptables --list
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
ACCEPT     icmp --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:ssh 
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:http 
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:https 
ACCEPT     tcp  --  anywhere             anywhere            state NEW tcp dpt:60128 

.......</code></pre>

<h2 id='disable_root_login'>Disable root login</h2>

<p>If the hacker still gets to connect to your ssh port, he will need authentication. Obvisously he will try the root account which grant maximum priviledge on the server, so you want to disable direct root ssh access.</p>

<p>Find this line in your /etc/ssh/sshd_config and change its value to &#8220;no&#8221;</p>

<pre><code>PermitRootLogin no</code></pre>

<h2 id='disable_protocol_1'>Disable Protocol 1</h2>

<p>SSH has two protocols it may use, protocol 1 and protocol 2. The older protocol 1 is less secure and should be disabled unless you know that you specifically require it. Look for the following line in the /etc/ssh/sshd_config file, uncomment it and amend as shown:</p>

<pre><code># Protocol 2,1
Protocol 2</code></pre>

<h2 id='use_publicprivate_keys_for_authentication'>Use Public/Private Keys for Authentication</h2>

<h3 id='clientcreate_publicprivate_key'>Client:Create public/private key</h3>

<p>First, create a public/private key pair on the client that you will use to connect to the server:</p>

<pre><code>[edwin@client]$ ssh-keygen -t rsa</code></pre>

<p>This will create two files in your (hidden) ~/.ssh directory called id_rsa and id_rsa.pub. id_rsa is your private key and id_rsa.pub is your public key. Now set permissions on your private key:</p>

<pre><code>[edwin@client]$ chmod 700 ~/.ssh
[edwin@client]$ chmod 600 ~/.ssh/id_rsa </code></pre>

<h3 id='serversetup_authorized_keys'>Server:Setup authorized_keys</h3>

<p>Copy the public key (id_rsa.pub) to the server and install it to the authorized_keys list:</p>

<pre><code>[root@server.com]# cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre>

<p>Note: once you have imported the public key, you can delete it from the server.</p>

<p>and finally set file permissions on the server:</p>

<pre><code>[root@server.com]# chmod 700 ~/.ssh
[root@server.com]# chmod 600 ~/.ssh/authorized_keys</code></pre>

<p>The above permissions are required if StrictModes is set to yes in /etc/ssh/sshd_config (the default).</p>

<h3 id='serversetup_sshd_config'>Server:Setup sshd_config</h3>

<p>Once you have checked you can successfully login to the server using your public/private key pair, you can disable password authentication completely by adding the following setting to your /etc/ssh/sshd_config file:</p>

<p>Disable password authentication forcing use of keys PasswordAuthentication no</p>

<h3 id='serverrestart_sshd_service'>Server:Restart sshd service</h3>

<pre><code>[root@server.com]# /etc/rc.d/init.d/sshd restart</code></pre>

<h3 id='clienttest'>Client:Test</h3>

<pre><code>[edwin@client]$ ssh root@server.com -p 60128</code></pre>
    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/Github/2013/02/05/install-github-and-jekyll-on-ubuntu" title="在Ubuntu上安装Github和Jekyll">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/Linux/2013/02/11/install-touchpad-indicator-in-ubuntu-1204" title="在Ubuntu 12.04上安装配置Touchpad Indicator">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


	</div>
      </div>
      
      <footer>
        <ul id="footerNaviBnt">
                                <a href="/"><img src="/images/bnt_home.gif"/></a>
                                <a href="#top"><img src="/images/bnt_top.gif"/></a>
                        </ul>
        <div id="footerContent"> 
	 <div class="footerLogo">
		<img src="/images/lampnode-code-small.png" width="90px" height="90px" style="background-color:#cccccc;border:1px solid #555555;padding:5px;margin:0px 10px"/>
	 </div>
         <div class="footerBox">
            	<p class="footBoxItems">
	    		<ul id="footerNaviList">
             			
             			
             			


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/about.html">关于本站</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/categories.html">文档归类</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">技术档案</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/archive.html">技术日志</a></li>
      	
      
    
  
    
      
      	
      	<li><a href="/tags.html">文档标签</a></li>
      	
      
    
  



				<li> <a href="/atom.xml" title="ATOM" class="siteRss"><img src="/images/atom.png" /></a></li>
			</ul>
           	</p>
	   	<p class="footBoxItems"><img src="/images/gnu-fdl.png"/> Copyleft 2013 for Robert  Chain. Unless otherwise stated, all content are available under <a href="http://www.gnu.org/copyleft/fdl.html" class="external ">GNU Free Documentation License 1.3</a>.</p>
    	   	<p class="footBoxItems">Powered by Github, With help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a> and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>.</p> 
	</div>
     </div>     
</footer>

    </div> <!-- /container -->

    
  </body>
</html>

